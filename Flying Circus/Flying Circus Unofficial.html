<div class="characterwrapper">
	<div class="menuwrapper">
		<div class="title" data-i18n="flying-circus">Flying Circus</div>
		<div class="horiz-line2">&nbsp;</div>
		<div class="flexrow stats">
			<div class="flexcol hard"><input type="text" name="attr_character-hard" /><button type="roll" value="&{template:do2d10} {{rollname=Hard Roll}} {{resadv=[[3d10kh2+(@{character-hard})]]}} {{resdis=[[3d10kl2+(@{character-hard})]]}} {{resnorm=[[2d10+@{character-hard}]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}}" data-i18n="hard">Hard</button></div>
			<div class="flexcol keen"><input type="text" name="attr_character-keen" /><button type="roll" value="&{template:do2d10} {{rollname=Keen Roll}} {{resadv=[[3d10kh2+(@{character-keen})]]}} {{resdis=[[3d10kl2+(@{character-keen})]]}} {{resnorm=[[2d10+@{character-keen}]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}}" data-i18n="keen">Keen</button></div>
			<div class="flexcol calm"><input type="text" name="attr_character-calm" /><button type="roll" value="&{template:do2d10} {{rollname=Calm Roll}} {{resadv=[[3d10kh2+(@{character-calm})]]}} {{resdis=[[3d10kl2+(@{character-calm})]]}} {{resnorm=[[2d10+@{character-calm}]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}}" data-i18n="calm">Calm</button></div>
			<div class="flexcol daring"><input type="text" name="attr_character-daring" /><button type="roll" value="&{template:do2d10} {{rollname=Daring Roll}} {{resadv=[[3d10kh2+(@{character-daring})]]}} {{resdis=[[3d10kl2+(@{character-daring})]]}} {{resnorm=[[2d10+@{character-daring}]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}}"  data-i18n="daring">Daring</button></div>
			<input type="hidden" class='wild-toggle' name='attr_wild-toggle' value='none'/>
			<div class="flexcol wild"><input type="text" name="attr_character-wild" /><button type="roll" value="&{template:do2d10} {{rollname=Wild Roll}} {{resadv=[[3d10kh2+(@{character-wild})]]}} {{resdis=[[3d10kl2+(@{character-wild})]]}} {{resnorm=[[2d10+@{character-wild}]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}}" data-i18n="wild">Wild</button></div>
		</div>
		<div class="common flexrow">
			<div class="flexcol stress">
				<div class="flexrow stress small-title">
					<span data-i18n="stress">Stress:</span>
					<!-- stressed out indicator -->
					<input type="hidden" class='stressed-out-toggle' name='attr_stressed-out-toggle' value='none' />
					<div class="stressed-out aligncenter"><span data-i18n="stressed-out">STRESSED OUT</span></div>
					<!-- burnt out indicator -->
					<input type="hidden" class='burnt-out-toggle' name='attr_burnt-out-toggle' value='none' />
					<div class="burnt-out aligncenter"><span data-i18n="burnt-out">BURNT OUT</span></div>
				</div>
				<div class="flexrow stressed">
					<div class="flexcol stress box"><input type="checkbox" name="attr_chk-stress1" /></div>
					<div class="flexcol stress box"><input type="checkbox" name="attr_chk-stress2" /></div>
					<div class="flexcol stress box"><input type="checkbox" name="attr_chk-stress3" /></div>
					<div class="flexcol stress box"><input type="checkbox" name="attr_chk-stress4" /></div>
					<div class="flexcol stress box"><input type="checkbox" name="attr_chk-stress5" /></div>
					<div class="flexcol stress box"><input type="checkbox" name="attr_chk-stress6" /></div>
					<div class="flexcol stress box"><input type="checkbox" name="attr_chk-stress7" /></div>
					<div class="flexcol stress box"><input type="checkbox" name="attr_chk-stress8" /></div>
					<div class="flexcol stress box"><input type="checkbox" name="attr_chk-stress9" /></div>
					<div class="flexcol stress box"><input type="checkbox" name="attr_chk-stressA" /></div>
				</div>
			</div>
			<div class="flexrow experience">
				<span class ="small-title experience" data-i18n="experience">Experience:</span> <input type="text" name="attr_experience" />
			</div>
		</div>
		<div class="horiz-line">&nbsp;</div>
		<div class="tab-toggles">
			<button type="action" name="act_Ground" checked="checked" data-i18n-placeholder="ground">Ground</button>
			<button type="action" name="act_Plane" checked="checked" data-i18n-placeholder="plane">Plane</button>
		</div>
		
	</div>
	
	<div class="game-moves-container flexrow">
		<div class="moves-toggle">
			<span data-i18n="toggle-move-display">Toggle Move Display:</span> <input type="checkbox" class="check-toggle" name="attr_chk-moves-toggle" checked="checked" />
		</div>
		<input type="hidden" class="move-toggle" name="attr_game-moves-toggle" value="0" />
		<div class="game-moves-container">
			<div class="flexrow">
			<!---repeating_engine-cards_$0_reliability -->
				<div class="flexcol universal game-moves">
					<span data-i18n="universal" class="move-title">Universal</span>
					<ul>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Press Your Luck}} {{rollbody= *When you take a risk, **you do it**, and consequences unfold.*}}">Press your Luck</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Break Trust}} {{rollbody=*When you lose trust in a comrade*, erase their mark and choose one.
							*    Keep your feelings hidden, and **take 1 stress**
							*    Show directly and explicitly how you feel, and **remove 1 stress** }}">Break Trust</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Restore Trust}} {{rollbody=*When you show faith in a comrade*, mark Trust and take 1 Stress.}}">Restore Trust</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Help/Hinder}} {{rollbody=*When you put yourself at risk to help a comrade*, give them Advantage forward. If you didn't trust them, Restore Trust.
							
							*When you make a point to hinder a comrade*, give them Disadvantage forward. If you trusted them, Break Trust.}}">Help/Hinder</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Discover Beauty}} {{rollbody=*Once per routine, when you witness beauty in the world*, describe how you are moved by what you see, and lose 1 Stress.}}">Discover Beauty</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Intimacy}} {{rollbody=*When you share a moment of emoional (and possibly physical) intimacy with one or more characters*, all PCs activate their Intimacy Move.}}">Intimacy</button>
						</li>
					</ul>
				</div>
				<div class="flexcol preflight game-moves">
					<span data-i18n="preflight" class="move-title">Preflight</span>
					<ul>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Contact}} {{rollbody=*When you take off*, the GM yells 'Contact!' Respond 'Switch On!', mark 1 RPM on all engines, set cruising Altitude, and set Speed to the lowest Max in the squadron. Make engine noises as appropriate.}}">Contact</button>
						</li>
						<li>
							<button type="roll" value="&{template:do2d10} {{rollname=Air Patrol}} {{holds=[[?{Number of times doing Air Patrol?|0}]]}} {{resadv=[[3d10kh2+(@{character-calm}) + (?{Number of times doing Air Patrol?|0})]]}} {{resdis=[[3d10kl2+(@{character-calm}) +?{Number of times doing Air Patrol?|0}]]}} {{resnorm=[[2d10+@{character-calm}+?{Number of times doing Air Patrol?|0}]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}} {{success=[[15]]}} {{costlysuccess=[[11]]}} {{successtext= You find what you were looking for.}} {{costlysuccesstext=You find something else.}} {{failuretext=Something finds you and Engage is rolled at Disadvantage or push Fuel Check and roll again.}}" >
								Air Patrol
							</button>
						</li>
						<li>
							<button type="roll" value="&{template:do2d10} {{rollname=Long Haul}} {{resadv=[[3d10kh2]]}} {{resnorm=[[2d10]]}} {{resdis=[[3d10kl2]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}} {{success=[[15]]}} {{successtext=The rest of your journey is uneventful.}} {{costlysuccess=[[11]]}} {{costlysuccesstext=You face potential problems from your machine, a passing plane, or the ground. Once resolved, roll again.}} {{failuretext=}}">
								Long Haul
							</button>
						</li>
					</ul>
				</div>
				<div class="flexcol air-combat game-moves">
					<span data-i18n="air-combat" class="move-title">Air Combat</span>
					<ul>
						<li>
							<button type="roll" value="&{template:do2d10} {{rollname=Engage}}{{resadv=[[3d10kh2 + (?{Engage bonuses?|0})]]}} {{resnorm=[[2d10 + (?{Engage bonuses?|0})]]}} {{resdis=[[3d10kl2 + (?{Engage bonuses?|0})]]}} {{success=[[15]]}} {{costlysuccess=[[11]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}} {{options=On a 16+ choose 2. On a success at a cost, choose 1. Then the enemy chooses one.*When you join a fight or ambush*, just pick 1. 
						
						*   Start with altitude Advantage.
						*   Spot the enemy and act while they are unaware.
						*   Catch the enemy spread out.
						*   Come in behind your foe.}}" >Engage</button>
						</li>
						<li>
							<button type="roll" value="&{template:do2d10} {{rollname=Stay on Target}}{{resadv=[[3d10kh2 +@{character-calm}]]}} {{resnorm=[[2d10+@{character-calm}]]}} {{resdis=[[3d10kl2+@{character-calm}]]}} {{success=[[15]]}} {{costlysuccess=[[11]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}} {{costlysuccesstext=You make it to the target, and only then face consequences.}} {{successtext=Choose 1: take Advantage forward, or soften the consequences.}}">Stay on Target</button>
						</li>
						<li>
							<button type="roll" value="&{template:do2d10} {{rollname=Evade Danger}}{{resadv=[[3d10kh2 + (@{character-keen})]]}} {{resnorm=[[2d10 + (@{character-keen})]]}} {{resdis=[[3d10kl2 + (@{character-keen})]]}} {{success=[[15]]}} {{costlysuccess=[[11]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}} {{costlysuccesstext=Choose 1.}} {{successtext=You evade danger.}} {{failuretext=Take all three.}} {{options=
							 *    You are left vulnerable as you recover your nerves.
							 *    Take [[1d10 * (@{air-speed-hundreds})]] Structure damage.
							 *    Go into a spin.}}">Evade Danger</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Overwatch}} {{rollbody=*When you watch over a friend*, hold one. Spend your hold to...
							 *    Help or Hinder one of their Moves
							 *    Place yourself between them and a pursuer.
							 *    Drop on the tail of their pursuer, no roll required.}}">Overwatch</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Chase!}} {{rollbody=*When there's a straight line chase or race*, **compare speeds**.
							*    *If you're at equal speed*, nothing changes.
						    *    *If the pursuer is faster*, move one range band closer.
							*    *If the defender is faster*, move one range band farther away.
								
							A difference in speed of 10 or more means the chase immediately ends: the pursuer gets as close as they want, or the defender gets out of range.
								
							*If a plane is forced to turn*, they count as slower regardless of speed.}}">Chase!</button>
						</li>
						<li>
							<button type="roll" value="&{template:dogfight} {{dftype=Pursue Them, Make an Attack}} {{rnorm=[[2d10+@{character-hard} + (?{Speed factor of other plane?|0})]]}}">Dogfight - Pursue Them, Make an Attack</button>
						</li>
						<li>
							<button type="roll">Dogfight - Escape a Bad Spot, Bait Them, Defend</button>
						</li>
						<li>
							<button type="roll">Dogfight - Turn the Tables on Your Pursuer</button>
						</li>
					</ul>
				</div>
				<div class="flexcol support game-moves">
					<span data-i18n="support" class="move-title">Support</span>
					<ul>
						<li>
							<button type="roll" value="&{template:do2d10} {{rollname=Eyeball}} {{resadv=[[3d10kh2 +(@{character-keen}) + (@{visibility})]]}} {{resnorm=[[2d10+(@{character-keen}) + (@{visibility})]]}} {{resdis=[[3d10kl2+(@{character-keen}) + (@{visibility})]]}} {{success=[[15]]}} {{costlysuccess=[[11]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}} {{costlysuccesstext=The GM gives you an answer, and you take Advantage forward to react.}} {{successtext=The GM gives you an answer, and you take Advantage forward to react. The answer puts you in a position of strength.}} {{failuretext=The GM gives you an answer, and you take Advantage forward to react. The answer is one you don't want to hear.}}">Eyeball</button>
						</li>
						<li>
							<button type="roll" value="&{template:do2d10} {{rollname=Empty Seat}} {{resadv=[[3d10kh2 + (@{stability})]]}} {{resnorm=[[2d10 + (@{stability})]]}} {{resdis=[[3d10kl2 + (@{stability})]]}} {{success=[[15]]}} {{costlysuccess=[[11]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}} {{costlysuccesstext=The plane starts listing, turning, or diving.}} {{successtext=It ploughs on for awhile.}} {{failuretext=???}}">Empty Seat</button>
						</li>
						<li>
							<button type="roll">Wingwalk</button>
						</li>
						<li>
							<button type="roll" value="&{template:do2d10} {{rollname=Patch Fix}} {{resadv=[[3d10kh2 + (@{character-keen}) ]] }} {{resnorm=[[2d10 + (@{character-keen}) ]] }} {{resdis=[[3d10kl2 + (@{character-keen}) ]] }} {{success=[[15]]}} {{costlysuccess=[[11]]}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}} {{costlysuccesstext=Choose 1.}} {{successtext=Choose 2.}} {{failuretext=Choose none.}} {{options=
							 *    Negate 1 Wear. (Can choose more than once.)
							 *    Put out a fire.
							 *    Patch and refill a damaged radiator.
							 *    Restart an engine.}}">Patch Fix</button>
						</li>
					</ul>
				</div>
				<div class="flexcol manoevers game-moves">
					<span data-i18n="manoevers" class="move-title">Manoevers</span>
					<ul>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Extend}} {{rollbody=*When you fly straight to regain speed*, increase your speed up to Max Speed, add +1 RPM, reduce your G-Force tracker to 0, and...
							
							 *    If you are clear of immediate danger, disengage from the fight.
							 *    If you are in the thick of things, leave yourself vulnerable.
							 
							 You cannot Extend if you don't have engine power.}}">Extend</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Altitude Adjustment - Nose Up}} {{rollbody=*When you point the nose up*, trade Speed for Altitude, 5 to 1. If you are gliding, trade Speed for Altitude 6 to 1.}}">Altitude Adjustment - Nose Up</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Altitude Adjustment - Climb Stead}} {{rollbody=*When you climb steady*, reduce your speed to your stall speed. When you next act, climb by up to your Climb and gain 1 RPM. You can't steady climb without engine power.}}">Altitude Adjustment - Climb Steady</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Altitude Adjustment - Nose Down}} {{rollbody=*When you point the nose down*, trade Altitude for Speed, 1 to 3.
							
							*If you aren't diving*, and your Speed is above your Max Speed (@{max-speed}), reduce your Speed by your Energy Loss (@{energy-loss}). This can't take you below Max Speed.}}">Altitude Adjustment - Nose Down</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Pull Up}} {{rollbody=*When you pull up from a steep dive or out of an attack*, take G-Force equal to Speed Factor (@{air-speed-hundreds}). You can spend Altitude to reduce G-Force taken, 1-1. You can take no more G-Force than 1/10th your Handling ([[floor(@{full-load-handling}/10)]] ).
							
							If you Pull Up at Altitude 0, **Evade Danger**.}}">Pull Up</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Overstrain}} {{rollbody=Take [[(@{g-force}d10)-(@{character-daring})]] Damage. If your plane survives, reset G-Force to [[floor((@{max-strain})/10)]] Gs.  }}">Overstrain</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Overspeed}} {{rollbody=The engine gains +1 + [[ floor((((@{air-speed-hundreds}*10) + @{air-speed-tens})-(@{overspeed}))/5) ]] RPM. }}">Overspeed</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Boost}} {{rollbody=Add your plane's Boost (@{full-load-boost}) to your Speed, up to Max Speed (@{max-speed}). You can add less than your full Boost.
							
							If your speed is below your Dropoff (@{dropoff}), double your Boost.
							
							*If you Boost in a Dive*, add to your Speed, even above your Max Speed.
							
							Then increase your engine RPM by 1.}}">Boost</button>
						</li>
						<li>
							<button type="roll" value="&{template:simple-roll} {{rollname=Cool Off}} {{rollbody=Reduce your speed to Max Speed (@{max-speed}) or less.
							
							Take [[(@{RPM})d20<=@{comparable-reliability}]] Wear on your engine.}}">Cool Off</button>
						</li>
						<li>
							<button type="roll">Stall/Spin</button>
						</li>
						<li>
							<button type="roll" value="&{template:do2d10} {{rollname=Recover}} {{resadv=[[3d10kh2 + (@{character-calm}) + (@{stability})]]}} {{resnorm=[[2d10 + (@{character-calm}) + (@{stability})]]}} {{resdis=[[3d10kl2 + (@{character-calm}) + (@{stability})]]}} {{success=[[15]]}} {{costlysuccess=[[10]]}} {{successtext=You recover smoothly.}} {{costlysuccess=You spin for 6 Energy}} {{failuretext=Spin for 12 energy}} {{options=You must spend Energy (Speed or Altitude, in any mix) equal to the spin to recover. You must then **Dive** and/or **Boost** back to your Stall speed.}} {{rtype=[[?{Roll Type|Advantage, 1|Normal,0|Disadvantage,-1}]]}}">Recover</button>
						</li>
						<li>
							<button type="roll" value="&{template:collision} {{sf_other=[[(?{Speed Factor of the Other Plane?|1})]]}}  {{sf_other_d20=[[(?{Speed Factor of the Other Plane?|1})d20]]}} {{sf_self_d20=[[(@{air-speed-hundreds})d20]]}} {{sf_self=[[@{air-speed-hundreds}]]}} {{min_roll_d20=[[1d20]]}} {{head_on=[[?{Head-On Collision?|Yes,1|No,0}]]}}">Collision</button>
						</li>
					</ul>
				</div>
				<div class="flexcol going-down game-moves">
					<span data-i18n="going-down" class="move-title">Going Down</span>
					<ul>
						<li>
							<button type="roll">Bail Out</button>
						</li>
						<li>
							<button type="roll">Go Down</button>
						</li>
					</ul>
				</div>
			</div>
			
		</div>
		<div class="game-moves-container">
			<div class="game-moves flexcol dogfight ">
				<span data-i18n="dogfight" class="move-title">Dogfight!</span>
				
				<div class="primary-target handling">
					<span class="move-label">Primary Target's Handling</span>
					<input type="text" name="attr_primary-target-handling" class="dogfight" />
				</div>
				
				<!--div class="turn-commit">
					<span class="move-label">Commit to the Turn</span>
					<input type="number" name="attr_commit-speed" class="turn-commit"/>
				</div-->
				<div class="calculated-fields">
					<span class="auto-calc"> Auto-Calculated Fields</span>
					<div class="turn-bleed">
						<span class="move-label">Turn Bleed</span>
						<span class="turn-bleed value" name="attr_turn-bleed"></span>
					</div>
					<div class="speed-factor">
						<span class="move-label" title="(air-speed in the thousands)">Current Speed Factor</span>
						<span class="speed-factor" name="attr_air-speed-hundreds" ></span>
					</div>
					<div class="req-base-speed-spend">
						<span class="move-label" title="You need to spend at least this much speed when dog fighting. It is your Turn Bleed + Speed Factor." >Required base speed spend to dogfight</span>
						<input type="text" disabled="true" name="attr_base-speed-spend" value="@{turn-bleed}+@{air-speed-hundreds}" />
					</div>
					<!--div>
						<span>Total bonus from <em>Commit to the Turn</em></span>
						<input type="text" disabled="true" name="attr_cttt-bonus" value="floor(@{commit-speed}/@{turn-bleed})" />
					</div-->
					<div class="g-force">
						<span class="move-label">Accrued G-Force</span>
						<input type="text" disabled="true" name="attr_accrued-g-force" value="@{air-speed-hundreds}" />
					</div>
					<div class="agility">
						<span class="label" title="Calculated from the difference between your handling and the primary target's handling">Agility</span>
						<span class="auto-calc" name="attr_agility"></span>
						
					</div>
				</div>
				<div class="flexrow dogfight buttons">
					<button type="roll" title="Roll +Hard" value="&{template:do2d10} {{rollname=Dogfight}} {{resnorm=[[2d10+(@{character-hard}[Hard])]]}} {{rtype=[[0]]}}">Pursuit or Attack</button>
					<button type="roll" title="Roll +Keen" value="&{template:do2d10} {{rollname=Dogfight}} {{resnorm=[[2d10+(@{character-keen}[Keen])]]}}  {{rtype=[[0]]}}">Escape, Bait, or Defend</button>
					<button type="roll" title="Roll +Daring" value="&{template:do2d10} {{rollname=Dogfight}} {{resnorm=[[2d10+(@{character-daring [Daring]})]]}}  {{rtype=[[0]]}}">Turn the Tables</button>
				</div>
				<input type="hidden" name="attr_dogfight_hard" />
				<input type="hidden" name="attr_dogfight_keen" />
				<input type="hidden" name="attr_dogfight_daring" />
			</div>
		</div>
	</div>
	
	<input type='hidden' class='sheet-tabstoggle' name='attr_sheetTab' value='ground' />
	<input type='hidden' class='sheet-toggles' name='attr_toggles' value='none' />

	<!-----------Ground---------->
	<div class="ground">
		<div class="flexcol bio">
			<div class="biginfo"><span data-i18n="character-identifier">Character Name/Identity:</span> <input type="text" name="attr_character-identifier" /> </div>
			<div class="biginfo">
				<span data-i18n="character-playbook">Playbook:</span> 
				<select name="attr_playbook"> 
					<option value="">-</option>
					<option value="Believer" data-i18n="believer">Believer</option>
					<option value="Farmer"   data-i18n="farmer"  >Farmer</option>
					<option value="Fisher"   data-i18n="fisher"  >Fisher</option>
					<option value="Scion"    data-i18n="scion"   >Scion</option>
					<option value="Skyborn"  data-i18n="skyborn" >Skyborn</option>
					<option value="Soldier"  data-i18n="soldier" >Soldier</option>
					<option value="Student"  data-i18n="student" >Student</option>
					<option value="Survivor" data-i18n="survivor">Survivor</option>
					<option value="Witch"    data-i18n="witch"   >Witch</option>
					<option value="Worker"   data-i18n="worker"  >Worker</option>
				</select>
			</div>
			<div class="biginfo"><span data-i18n="character-origin">Origin:</span> <input type="text" name="attr_character-origin" /> </div>
			<div class="biginfo"><span data-i18n="character-people">People:</span> <input type="text" name="attr_character-people" /> </div>	
			
		</div>
		<div class="flexrow bio2">
			<div class="biginfo"><span data-i18n="character-expectations">Expectations:</span> <textarea name="attr_character-expectations" > </textarea></div>
			<div class="biginfo"><span data-i18n="character-history">History:</span> <textarea name="attr_character-history" /> </textarea></div>
		</div>
		<div class="flexrow comrades-and-vices">
			<div class="flexcol smaller comrades">
				<div class="flexrow">
					<span class="comrades subtitle flexcol" data-i18n="comrades">Comrades</span> 
					<span class="trust subtitle flexcol" data-i18n="trust-q">Trust?</span>
				</div>
				<fieldset class="repeating_comrades">
					<div class="comrade">
						<span><input type="text" class="comrade-name" name="attr_comrade-title" placeholder="Comrade Name" /></span>
						<input type="checkbox" class="trust-box" checked="false" name="attr_comrade-trust"/>
					</div>
				</fieldset>
			</div>
			<div class="flexcol smaller vices">
				<span class="vices subtitle" data-i18n="vices">Familiar Vices</span>
				<fieldset class="repeating_vices">
					<div class="vice">
						<input type="text" class="vice-name" name="attr_vice-title" placeholder="Vice" />
					</div>
				</fieldset>
			</div>
		</div>
		<div class="flexrow assets baggage">
			<div class="flexcol assets">
				<div class="assets subtitle"><span data-i18n="assets">Assets</span></div>
				<label class="label asset"><input type="text" class="asset name_1" name="attr_asset-1"> </label>
				<label class="label asset"><input type="text" class="asset name_2" name="attr_asset-2"> </label>
				<label class="label asset"><input type="text" class="asset name_3" name="attr_asset-3"> </label>
			</div>
		
			<div class="flexcol baggage">
				<div class="baggage subtitle"><span data-i18n="baggage">Baggage</span></div>
				<label class="label baggage"><input type="text" class="asset name_1" name="attr_asset-1"> </label>
				<label class="label baggage"><input type="text" class="asset name_2" name="attr_asset-2"> </label>
				<label class="label baggage"><input type="text" class="asset name_3" name="attr_asset-3"> </label>
			</div>
		</div>
		<div class="flexcol moves">
			<div class="subtitle" data-i18n="moves">Moves</div>
			<div>
				<fieldset class="repeating_skills moves">
					<div class="moves">
						<input type="text" class="move-title" name="attr_move-title" placeholder="Move Name" />
						<textarea class="move-info" name="attr_move-info" placeholder="Description"> </textarea>
					</div>
				</fieldset>
			</div>
		</div>
		<div class="flexcol mastery">
			<div class="mastery subtitle"><span data-i18n="mastery">Mastery</span></div>
			<div class="mastery moves"><textarea name="attr_mastery-moves"> </textarea> </div>
			<div class="flexrow">
				<span class="mastery box"><input type="checkbox" name="attr_chk-mastery1" /></span>
				<span class="mastery box"><input type="checkbox" name="attr_chk-mastery2" /></span>
				<span class="mastery box"><input type="checkbox" name="attr_chk-mastery3" /></span>
				<span class="mastery box"><input type="checkbox" name="attr_chk-mastery4" /></span>
				<span class="mastery box"><input type="checkbox" name="attr_chk-mastery5" /></span>
			</div>
		</div>
	</div>
	<div class="plane">
		<div class="flexcol">
			<div class="flexrow dashboard">
				<div class="flexcol left-side">
					<div class="altitude indicator">
						<div>
							<span class="altitude-label"> Altitude Thousands</span>
							<select name="attr_altitude-thousands"> 
								<option value="0">(0)000</option>
								<option value="1">&#x2474;000</option>
								<option value="2">&#x2475;000</option>
								<option value="3">&#x2476;000</option>
								<option value="4">&#x2477;000</option>
								<option value="5">&#x2478;000</option>
								<option value="6">&#x2479;000</option>
								<option value="7">&#x247a;000</option>
								<option value="8">&#x247b;000</option>
								<option value="9">&#x247c;000</option>
							</select>
						</div>
						<div>
							<span class="altitude-label">Altitude Hundreds</span>
							<select name="attr_altitude-hundreds"> 
								<option value="0">(0)00</option>
								<option value="1">&#x2474;00</option>
								<option value="2">&#x2475;00</option>
								<option value="3">&#x2476;00</option>
								<option value="4">&#x2477;00</option>
								<option value="5">&#x2478;00</option>
								<option value="6">&#x2479;00</option>
								<option value="7">&#x247a;00</option>
								<option value="8">&#x247b;00</option>
								<option value="9">&#x247c;00</option>
							</select>
						</div>
						
						<div class="plate">Altitude</div>
					</div>
					<div class="flexrow plane-stats">
						<div class="air-stats indicator">
							<div class="visibility">
								<div class="label">Visibility</div>
								<input type="text" name="attr_visibility" />
							</div>
							<div class="energy-loss">
								<input type="text" name="attr_energy-loss" />
								<div class="label">Energy Loss</div>
							</div>
							<div class="turn-bleed">
								<input type="text" name="attr_turn-bleed" />
								<div class="label">Turn Bleed</div>
							</div>
							<div class="stability">
								<input type="text" name="attr_stability" /> 
								<div class="label">Stability</div>
							</div>
						</div>
						<div class="flexcol plane-stress square-box">
							<input type="text" name="attr_plane-stress" />
							<div class="label">Stress</div>
						</div>
					</div>
					<div class="flexrow">
						<div class="flexcol flight-stats">
							<div class="flexcol escape square-box">
								<input type="text" name="attr_escape" />
								<div class="label">Escape</div>
							</div>
							<div class="flexcol crash square-box">
								<input type="text" name="attr_crash" />
								<div class="label">Crash</div>
							</div>
						</div>
						<div class="plane-health indicator flexcol">
							<div class="toughness flexrow">
								<div class="toughness current">
									<input type="text" name="attr_toughness" />
								</div>
								<div class="toughness max">
									<input type="text" name="attr_toughness_max" />
								</div>
							</div>
							<span>Toughness</span>
							<div class="strain flexrow">
								<div class="strain current">
									<input type="text" name="attr_strain" />
								</div>
								<div class="strain max">
									<input type="text" name="attr_strain_max" />
								</div>
							</div>
							<span>Strain</span>
						</div>
					</div>
				</div>
				<div class="flexcol middle">
					<div class="flexrow variable-stats">
						<div class="flexcol labels">
							<div class="flexcol spacer">
							&nbsp;
							</div>
							<div class="flexcol">
								Full Load
							</div>
							<div class="flexcol">
								Half Fuel Bombs
							</div>
							<div class="flexcol">
								Full Fuel No Bombs
							</div>
							<div class="flexcol">
								Half Fuel No Bombs
							</div>
							<div class="flexcol empty">
								Empty
							</div>
						</div>
						<div class="flexcol boost">
							<div class="flexcol header">
								Boost
							</div>
							<div class="flexcol">
								<input type="text" name="attr_full-load-boost" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_half-fuel-bombs-boost" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_full-fuel-no-bombs-boost" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_half-fuel-no-bombs-boost" />
							</div>
							<div class "flexcol blank">
								-
							</div>
						</div>
						<div class="flexcol handling">
							<div class="flexcol header">
								Handling
							</div>
							<div class="flexcol">
								<input type="text" name="attr_full-load-handling" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_half-fuel-bombs-handling" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_full-fuel-no-bombs-handling" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_half-fuel-no-bombs-handling" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_empty-handling" />
							</div>
							
						</div>
						<div class="flexcol climb">
							<div class="flexcol header">
								Climb
							</div>
							<div class="flexcol">
								<input type="text" name="attr_full-load-climb" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_full-fuel-no-bombs-climb" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_half-fuel-bombs-climb" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_half-fuel-no-bombs-climb" />
							</div>
							<div class "flexcol blank">
								-
							</div>
						</div>
						<div class="flexcol stall">
							<div class="flexcol header">
								Stall
							</div>
							<div class="flexcol">
								<input type="text" name="attr_full-load-stall" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_full-fuel-no-bombs-stall" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_half-fuel-bombs-stall" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_half-fuel-no-bombs-stall" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_empty-stall" />
							</div>
						</div>
						<div class="flexcol speed">
							<div class="flexcol header">
								Speed
							</div>
							<div class="flexcol">
								<input type="text" name="attr_full-load-speed" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_full-fuel-no-bombs-speed" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_half-fuel-bombs-speed" />
							</div>
							<div class="flexcol">
								<input type="text" name="attr_half-fuel-no-bombs-speed" />
							</div>
							<div class "flexcol blank">
								-
							</div>
						</div>
						<div class="flexcol weight">
							<div class="flexcol header">Weight</div>
							<div class="flexcol radio"><input type="radio" name="attr_weight-marker" value="0"/></div>
							<div class="flexcol radio"><input type="radio" name="attr_weight-marker" value="1"/></div>
							<div class="flexcol radio"><input type="radio" name="attr_weight-marker" value="2"/></div>
							<div class="flexcol radio"><input type="radio" name="attr_weight-marker" value="4"/></div>
							<div class="flexcol radio"><input type="radio" name="attr_weight-marker" value="8"/></div>
						</div>
					</div>
					<div class="plate">Variable Stats</div>
					<div class="fuel square-box">
						<input type="text" name="attr_fuel" />
						<span>Fuel</span>
					</div>
					<div class="flexcol vital-parts">
						<div class="flexrow vital-parts header">
							Vital Parts
						</div>
						<fieldset class="repeating_vital_parts">
							<div class="vital-parts">
								<input type="text" class="vital-parts" name="attr_vital-parts"/>
							</div>
						</fieldset>
					</div>
					<div class="flexcol armour">
						<div class="armour header">
							Armour
						</div>
						<fieldset class="repeating_armour">
							<div class="armour">
								<input type="text" class="armour" name="attr_armour"/>
							</div>
						</fieldset>
					</div>
					<div class="flexcol ordinance">
						<div class="flexrow header"><span>Ordnance</span><input type="text" name="attr_max-bomb-load" placeholder="Max Bomb Load" /> </div>
						<fieldset class="repeating_ordnance">
							<div class="Ordnance">
								<input type="text" class="ordnance" name="attr_ordnance"/>
							</div>
						</fieldset>
					</div>
					
					<div class="flexcol notes">
						<span>Notes</span>
						<textarea name="attr_notes"></textarea>
					</div>
				</div>
				<div class="flexcol right-side">
					<div class="air-speed indicator">
						<div class="hundreds">
							<span class="air-speed-label">Air-Speed Hundreds</span>
							<select name="attr_air-speed-hundreds"> 
								<option value="0">000</option>
								<option value="1">100</option>
								<option value="2">200</option>
								<option value="3">300</option>
								<option value="4">400</option>
								<option value="5">500</option>
								<option value="6">600</option>
								<option value="7">700</option>
								<option value="8">800</option>
								<option value="9">900</option>
							</select>
						</div>
						<div class="tens">
							<span class="air-speed-label">Air-Speed Tens</span>
							<select name="attr_air-speed-tens"> 
								<option value="0">00</option>
								<option value="1">10</option>
								<option value="2">20</option>
								<option value="3">30</option>
								<option value="4">40</option>
								<option value="5">50</option>
								<option value="6">60</option>
								<option value="7">70</option>
								<option value="8">80</option>
								<option value="9">90</option>
							</select>
						</div>
						<div class="plate">Air Speed</div>
						<div class="air-speed-stats square-box">
							<input type="text" name="attr_dropoff" />
							<span>Dropoff</span>
						</div>
					</div>
					<div class="g-force indicator">
						<select class="g-force" name="attr_g-force">
							<option value="10">10</option>
							<option value="9">9</option>
							<option value="8">8</option>
							<option value="7">7</option>
							<option value="6">6</option>
							<option value="5">5</option>
							<option value="4">4</option>
							<option value="3">3</option>
							<option value="2">2</option>
							<option value="1">1</option>
							<option value="0" selected="selected">0</option>
						</select>
						<div class="label">G-Force</div>
					</div>
					
				</div>
			</div>
			<div class="flexrow cards">
				<fieldset class="repeating_engine-cards">
					<div class="engine-card">
						<div class="flexrow engine-inputs">
							<div class="reliability">
								<input type="text" name="attr_reliability" placeholder="Reliability" title="Reliability" />
							</div>
							<div class="ideal-altitude">
								<input type="text" name="attr_ideal-altitude" placeholder="Ideal Altitude" title="Ideal Altitude"/>
							</div>
							<div class="overspeed">
								<input type="text" name="attr_overspeed" placeholder="Overspeed" title="Overspeed"/>
							</div>
						</div>
						<div class="engine-calculated-fields">
							<div class="rpm-select">
								<span data-i18n="rpm">RPM</span>
								<select name="attr_RPM"> 
									<option value="0" data-i18n="zero"> 0</option>
									<option value="1" data-i18n="one">  1</option>
									<option value="2" data-i18n="two">  2</option>
									<option value="3" data-i18n="three">3</option>
									<option value="4" data-i18n="four"> 4</option>
									<option value="5" data-i18n="five"> 5</option>
									<option value="6" data-i18n="six">  6</option>
									<option value="7" data-i18n="seven">7</option>
								</select>
							</div>
							<div class="wear-select">
								<span data-i18n="wear">Wear</span>
								<select name="attr_wear"> 
									<option value="0" data-i18n="zero">      0</option>
									<option value="1" data-i18n="one">       1</option>
									<option value="2" data-i18n="two">       2</option>
									<option value="3" data-i18n="three">     3</option>
									<option value="4" data-i18n="four">      4</option>
									<option value="stop" data-i18n="stop-c"> STOP</option>
									<option value="6" data-i18n="six">       6</option>
									<option class="fire-option" value="fire" data-i18n="fire-x">FIRE!</option>
								</select>
							</div>
						</div>
					</div>
				</fieldset>
				<div class="flexcol weapons">
					<fieldset class="repeating_weapon-cards">
						<div class="flexcol weapon-card">
							<div class="flexcol weapon-stats">
								<div class=" flexrow weapon-type">
									<span class="header">Weapon Type</span>
									<input type="text" name="attr_weapon-type" />
								</div>
								<div class="weapon-stats-inner flexrow">
									<div class="flexcol">
										<span class="header">Ammo</span>
										<div class="weapon-stats input"><input type="text" name="attr_ammo" /></div>
									</div>
									<div class="flexcol">
										<span class="header">AP</span>
										<div class="weapon-stats input"><input type="text" name="attr_AP" /></div>
									</div>
									<div class="flexcol">
										<span class="header">Jam</span>
										<div class="weapon-stats input"><input type="text" name="attr_jam" /></div>
									</div>
								</div>
							</div>
							<div class="flexrow range-table">
								<div class="flexrow advantage-radios">
									<div class="flexcol radiocol">
										<span>Advantage</span>
										<input type="radio" name="attr_rtype" value="1"/>
									</div>
									<div class="flexcol radiocol">
										<span>Normal</span>
										<input type="radio" name="attr_rtype" value="0" checked="true" />
									</div>
									<div class="flexcol radiocol">
										<span>Disadvantage</span>
										<input type="radio" name="attr_rtype" value="-1"/>
									</div>
								</div>
								<div class="flexcol header labels">
									<div>Range</div>
									<div>Hits</div>
									<div>Damage</div>
								</div>
								<div class="flexcol">
									<div class="header"><button type="roll" value="@{open-fire-move-knife}" title="Open Fire at Knife Range!">Knife</button></div>
									<div><input type="text" name="attr_hits-knife" /></div>
									<div><input type="text" name="attr_damage-knife" /></div>
									<input type="hidden" name="attr_open-fire-move-knife" value="" />
								</div>
								<div class="flexcol">
									<div class="header"><button type="roll" value="@{open-fire-move-close}" title="Open Fire at Close Range!">Close</button></div>
									<div><input type="text" name="attr_hits-close" /></div>
									<div><input type="text" name="attr_damage-close" /></div>
									<input type="hidden" name="attr_open-fire-move-close" value="" />
								</div>
								<div class="flexcol">
									<div class="header"><button type="roll" value="@{open-fire-move-long}" title="Open Fire at Long Range!">Long</button></div>
									<div><input type="text" name="attr_hits-long" /></div>
									<div><input type="text" name="attr_damage-long" /></div>
									<input type="hidden" name="attr_open-fire-move-long" value="" />
								</div>
								<div class="flexcol">
									<div class="header"><button type="roll" value="@{open-fire-move-extreme}" title="Open Fire at Extreme Range!">Extreme</button></div>
									<div><input type="text" name="attr_hits-extreme" /></div>
									<div><input type="text" name="attr_damage-extreme" /></div>
									<input type="hidden" name="attr_open-fire-move-extreme" value="" />
								</div>
							</div>
							<div class="flexcol weapon-tags">
								<input type="text" name="attr_weapon-tags" placeholder="Tags" title="Tags for your weapon"/>
							</div>
						</div>
					</fieldset>
					
				</div>
				<div class="flexcol radiator-card">
				</div>
			</div>
		</div>
	</div>
</div>

<rolltemplate class="sheet-rolltemplate-do2d10">
	<div class="sheet-template-container">
		<div class="sheet-template-header">{{rollname}}</div>
		<div class="sheet-template-body">
			<div class="sheet-template-result-output">
				{{#rollTotal() rtype 1}}
					{{resadv}} {{#rollGreater() holds 0}} + {{holds}} holds. {{/rollGreater() holds 0}}
				{{/rollTotal() rtype 1}}
				{{#rollTotal() rtype 0}}
					{{resnorm}} {{#rollGreater() holds 0}} + {{holds}} holds. {{/rollGreater() holds 0}}
				{{/rollTotal() rtype 0}}
				{{#rollTotal() rtype -1}}
					{{resdis}} {{#rollGreater() holds 0}} + {{holds}} holds. {{/rollGreater() holds 0}}
				{{/rollTotal() rtype -1}}
			</div>
			{{#rollTotal() rtype 1}}
				{{#rollGreater() resadv success}}
					{{#^successtext}} Success! {{/^successtext}}
					{{#successtext}} {{successtext}} {{/successtext}}
				{{/rollGreater() resadv success }}
				{{#rollBetween() resadv costlysuccess success}}
					{{#^costlysuccesstext}} Success At A Cost! {{/^costlysuccesstext}}
					{{#costlysuccesstext}} {{costlysuccesstext}} {{/costlysuccesstext}}
				{{/rollBetween() resadv costlysuccess success}}
				{{#rollLess() resadv costlysuccess}}
					{{#^failuretext}} Failure {{/^failuretext}}
					{{#failuretext}} {{failuretext}} {{/failuretext}}
				{{/rollLess() resadv costlysuccess}}
			{{/rollTotal() rtype 1}}
			{{#rollTotal() rtype 0}}
				{{#rollGreater() resnorm success}}
					{{#^successtext}} Success! {{/^successtext}}
					{{#successtext}} {{successtext}} {{/successtext}}
				{{/rollGreater() resnorm success }}
				{{#rollBetween() resnorm costlysuccess success}}
					{{#^costlysuccesstext}} Success At A Cost! {{/^costlysuccesstext}}
					{{#costlysuccesstext}} {{costlysuccesstext}} {{/costlysuccesstext}}
				{{/rollBetween() resnorm costlysuccess success}}
				{{#rollLess() resnorm costlysuccess}}
					{{#^failuretext}} Failure {{/^failuretext}}
					{{#failuretext}} {{failuretext}} {{/failuretext}}
				{{/rollLess() resnorm costlysuccess}}
			{{/rollTotal() rtype 0}}
			{{#rollTotal() rtype -1}}
				{{#rollGreater() resdis success}}
					{{#^successtext}} Success! {{/^successtext}}
					{{#successtext}} {{successtext}} {{/successtext}}
				{{/rollGreater() resdis success }}
				{{#rollBetween() resdis costlysuccess success}}
					{{#^costlysuccesstext}} Success At A Cost! {{/^costlysuccesstext}}
					{{#costlysuccesstext}} {{costlysuccesstext}} {{/costlysuccesstext}}
				{{/rollBetween() resdis costlysuccess success}}
				{{#rollLess() resdis costlysuccess}}
					{{#^failuretext}} Failure {{/^failuretext}}
					{{#failuretext}} {{failuretext}} {{/failuretext}}
				{{/rollLess() resdis costlysuccess}}
			{{/rollTotal() rtype -1}}	
			{{#options}} <div class="sheet-template-options"> {{options}} </div> {{/options}}
		</div>
	</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-simple-roll">
	<div class="sheet-template-container">
		<div class="sheet-template-header">{{rollname}}</div>
		<div class="sheet-template-body">
			 {{rollbody}}
		</div>
	</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-collision">
	<div class="sheet-template-container">
		<div class="sheet-template-header">Collision</div>
		<div class="sheet-template-body"> 	
			Both planes take
			{{#rollTotal() head_on 1}}
				{{sf_other_d20}} + {{sf_self_d20}}
			{{/rollTotal() head_on 1}}
			{{#rollTotal() head_on 0}}
				{{#rollGreater() sf_other sf_self}}
					{{sf_other_d20}}
				{{/rollGreater() sf_other sf_self}}
				{{#rollGreater() sf_self sf_other}}
					{{sf_self_d20}}
				{{/rollGreater() sf_self sf_other}}
				{{#rollTotal() sf_self sf_other}}
					{{#rollTotal() sf_self 0}}
						{{min_roll_d10}}
					{{/rollTotal() sf_self 0}}
					{{#^rollTotal() sf_self 0}}
						{{sf_self_d20}}
					{{/^rollTotal() sf_self 0}}
				{{/rollTotal() sf_self sf_other}}
			{{/rollTotal() head_on 0}}
			<span data-i18n="damage">Damage:</span>
		</div>
	</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-open-fire">
	<div class="sheet-template-container">
		<div class="sheet-template-header">Open Fire - at {{range}} range</div>
		<div class="sheet-template-body"> 	
			<div class="sheet-roll-output">
				<span class="sheet-roll-label">Roll:</span><span class="sheet-roll-out">{{roll}}</span>
			</div>
			{{#rollGreater() roll 19}}
				<div class="sheet-roll-hits">Hits: {{closer-hits}}</div>
				<div class="sheet-roll-damage">Damage: {{closer-damage}}</div> 
				<div class="sheet-crits-roll">Crit Check: {{closer-crits-roll}}</div>
				{{#rollWasCrit() closer-crits-roll}}
					<div class="sheet-crew-crit">Your attack hits a crew member!</div>
				{{/rollWasCrit() closer-crits-roll}}
				{{#rollGreater() closer-crits-roll 19}}
					<div class="sheet-crit-results">The Attack crits!</div>
					{{#closer-crits-roll2}}
						<div class="sheet-crits-roll">Second Crit Check: {{closer-crits-roll2}}</div>
						{{#rollGreater() closer-crits-roll2 19}}
							<div class="sheet-crit-results">The attack crits again!</div>
							{{#closer-crits-roll3}}
								<div class="sheet-crits-roll">Third Crit Check: {{closer-crits-roll3}}</div>
								{{#rollGreater() closer-crits-roll3 19}}
									<div class="sheet-crit-results">The attack crits again!</div> 
									{{#closer-crits-roll4}}
										<div class="sheet-crits-roll">Fourth Crit Check: {{closer-crits-roll4}}</div>
									{{/closer-crits-roll4}}
								{{/rollGreater() closer-crits-roll3 19}}
							{{/closer-crits-roll3}}
						{{/rollGreater() closer-crits-roll2 19}}
					{{/closer-crits-roll2}}
				{{/rollGreater() closer-crits-roll 19}}
				{{#rollLess() closer-crits-roll jam-chance-closest}}
					<div class="sheet-crit-failure">Your gun(s) jam up!</div>
				{{/rollLess() closer-crits-roll jam-chance-closest}}
			{{/rollGreater() roll 19}}
			{{#rollBetween() roll 16 19}}
				<div class="sheet-roll-hits">Hits: {{current-hits}}</div>
				<div class="sheet-roll-damage">Damage: {{current-damage}}</div>
				<div class="sheet-crits-roll">Crit Check: {{current-crits-roll}}</div>
				{{#rollWasCrit() current-crits-roll}}
					<div class="sheet-crew-crit">Your attack hits a crew member!</div>
				{{/rollWasCrit() current-crits-roll}}
				{{#rollGreater() current-crits-roll 19}}
					<div class="sheet-crit-results">The Attack crits!</div>
					{{#current-crits-roll2}}
						<div class="sheet-crits-roll">Second Crit Check: {{current-crits-roll2}}</div>
						{{#rollGreater() current-crits-roll2 19}}
							<div class="sheet-crit-results">The attack crits again!</div>
							{{#current-crits-roll3}}
								<div class="sheet-crits-roll">Third Crit Check: {{current-crits-roll3}}</div>
								{{#rollGreater() current-crits-roll3 19}}
									<div class="sheet-crit-results">The attack crits again!</div> 
									{{#current-crits-roll4}}
										<div class="sheet-crits-roll">Fourth Crit Check: {{current-crits-roll4}}</div>
									{{/current-crits-roll4}}
								{{/rollGreater() current-crits-roll3 19}}
							{{/current-crits-roll3}}
						{{/rollGreater() current-crits-roll2 19}}
					{{/current-crits-roll2}}
				{{/rollGreater() current-crits-roll 19}}
				{{#rollLess() closer-crits-roll jam-chance-current}}
					<div class="sheet-crit-failure">Your gun(s) jam up!</div>
				{{/rollLess() closer-crits-roll jam-chance-current}}
			{{/rollBetween() roll 16 19}}
			{{#rollBetween() roll 11 15}}
				<div class="sheet-roll-hits">Hits: {{farther-hits}}</div>
				<div class="sheet-roll-damage">Damage: {{farther-damage}}</div>
				<div class="sheet-crits-roll">Crit Check: {{farther-crits-roll}}</div>
				{{#rollWasCrit() farther-crits-roll}}
					<div class="sheet-crew-crit">Your attack hits a crew member!</div>
				{{/rollWasCrit() farther-crits-roll}}
				{{#rollGreater() farther-crits-roll 19}}
					<div class="sheet-crit-results">The Attack crits!</div>
					{{#farther-crits-roll2}}
						<div class="sheet-crits-roll">Second Crit Check: {{farther-crits-roll2}}</div>
						{{#rollGreater() farther-crits-roll2 19}}
							<div class="sheet-crit-results">The attack crits again!</div>
							{{#farther-crits-roll3}}
								<div class="sheet-crits-roll">Third Crit Check: {{farther-crits-roll3}}</div>
								{{#rollGreater() farther-crits-roll3 19}}
									<div class="sheet-crit-results">The attack crits again!</div> 
									{{#farther-crits-roll4}}
										<div class="sheet-crits-roll">Fourth Crit Check: {{farther-crits-roll4}}</div>
									{{/farther-crits-roll4}}
								{{/rollGreater() farther-crits-roll3 19}}
							{{/farther-crits-roll3}}
						{{/rollGreater() farther-crits-roll2 19}}
					{{/farther-crits-roll2}}
				{{/rollGreater() farther-crits-roll 19}}
				{{#rollLess() closer-crits-roll jam-chance-farther}}
					<div class="sheet-crit-failure">Your gun(s) jam up!</div>
				{{/rollLess() closer-crits-roll jam-chance-farther}}
			{{/rollBetween() roll 11 15}}
			{{#rollLess() roll 11}}
				 <div class="sheet-roll-hits">Hits: {{furthest-hits}}</div>
				<div class="sheet-roll-damage">Damage: {{furthest-damage}}</div>
				<div class="sheet-crits-roll">Crit Check: {{furthest-crits-roll}}</div>
				{{#rollWasCrit() furthest-crits-roll}}
					<div class="sheet-crew-crit">Your attack hits a crew member!</div>
				{{/rollWasCrit() furthest-crits-roll}}
				{{#rollGreater() furthest-crits-roll 19}}
					<div class="sheet-crit-results">The Attack crits!</div>
					{{#furthest-crits-roll2}}
						<div class="sheet-crits-roll">Second Crit Check: {{furthest-crits-roll2}}</div>
						{{#rollGreater() furthest-crits-roll2 19}}
							<div class="sheet-crit-results">The attack crits again!</div>
							{{#furthest-crits-roll3}}
								<div class="sheet-crits-roll">Third Crit Check: {{furthest-crits-roll3}}</div>
								{{#rollGreater() furthest-crits-roll3 19}}
									<div class="sheet-crit-results">The attack crits again!</div> 
									{{#furthest-crits-roll4}}
										<div class="sheet-crits-roll">Fourth Crit Check: {{furthest-crits-roll4}}</div>
									{{/furthest-crits-roll4}}
								{{/rollGreater() furthest-crits-roll3 19}}
							{{/furthest-crits-roll3}}
						{{/rollGreater() furthest-crits-roll2 19}}
					{{/furthest-crits-roll2}}
				{{/rollGreater() furthest-crits-roll 19}}
				{{#rollLess() closer-crits-roll jam-chance-furthest}}
					<div class="sheet-crit-failure">Your gun(s) jam up!</div>
				{{/rollLess() closer-crits-roll jam-chance-furthest}}
			{{/rollLess() roll 11}}
			
			<div class="sheet-open-fire-crit-options">
				A Crit destroys one of the planes Vital Parts. 
			</div>
		</div>
	</div>

</rolltemplate>

<rolltemplate class="sheet-rolltemplate-dogfight">
	<div class="sheet-template-container">
		<div class="sheet-template-header">Dogfight!</div>
		<div class="sheet-template-body"> 	
			 <em>{{dftype}}</em>
			<div class="sheet-roll-output">
				<span class="sheet-roll-label">Roll:</span><span class="sheet-roll-out">{{rnorm}}</span>
			</div>
		</div>
	</div>
</rolltemplate>

<script type="text/worker">
	const attribs = ['hard', 'keen', 'calm', 'daring', 'wild'];
	
	on("change:playbook", function(e) {
		updatePlaybook(e);
	});
	
	const engine_ids = ["0"];
	on("change:repeating_engine-cards_0_reliability", function(e) {
		console.log(e);
		var rel = e.newValue;
		var comparableReliability = 10 + (-1*rel);
		setAttrs({"comparable-reliability": comparableReliability});
	});
	
	on("change:chk-stress5 change:chk-stressA change:chk-moves-toggle", function(e) {
		if (e.sourceAttribute === "chk-stressa")
		{
			if (e.newValue === "on")
			{
				setAttrs({"burnt-out-toggle": 'on'});
			}
			else 
			{
				setAttrs({"burnt-out-toggle":'none'});
			}
		}
		else if (e.sourceAttribute === "chk-moves-toggle")
		{
			if (e.newValue === "on")
			{
				setAttrs({"game-moves-toggle": 'on'});
			}
			else 
			{
				setAttrs({"game-moves-toggle":'none'});
			}
		}
		else 
		{
			if (e.newValue === "on")
			{
				setAttrs({"stressed-out-toggle": 'on'});
			}
			else 
			{
				setAttrs({"stressed-out-toggle":'none'});
			}
		}
	});
	
	
	const buttonlist = ["ground","plane"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });
	
	on("change:repeating_engine-cards", function() {
		getSectionIDs("engine-cards", function(idarray) {
			
		});
	});
	
	var modify_jamming = function(st, closest_hits, current_hits, farther_hits, furthest_hits) {
		var result = st.replace(/#distance#/g, "closest").replace(/#hits#/g, closest_hits);
		result += st.replace(/#distance#/g, "current").replace(/#hits#/g, current_hits);
		result += st.replace(/#distance#/g, "farther").replace(/#hits#/g, farther_hits);
		result += st.replace(/#distance#/g, "furthest").replace(/#hits#/g, furthest_hits);
		
		return result;
	};
	
	const keys = ["rtype", "hits-knife", "damage-knife", "hits-close", "damage-close", "hits-long", "damage-long", "hits-extreme", "damage-extreme", "jam", "weapon-tags"];
	on("change:repeating_weapon-cards", function() {
		console.log("weapon cards");
		getSectionIDs("weapon-cards", function(idarray) {
			for(var i=0; i<idarray.length; i++) {
				let id = idarray[i];
				let parms = [];
				keys.forEach(key => {
					parms.push(`repeating_weapon-cards_${id}_${key}`);
				});
				getAttrs(parms, function(v) {
					let roll_type = parseInt(v[`repeating_weapon-cards_${id}_rtype`]);
					
					let knife_hits = parseInt(v[`repeating_weapon-cards_${id}_hits-knife`]);
					let knife_damage = parseInt(v[`repeating_weapon-cards_${id}_damage-knife`]);
					
					let close_hits = parseInt(v[`repeating_weapon-cards_${id}_hits-close`]);
					let close_damage = parseInt(v[`repeating_weapon-cards_${id}_damage-close`]);
					
					let long_hits = parseInt(v[`repeating_weapon-cards_${id}_hits-long`]);
					let long_damage = parseInt(v[`repeating_weapon-cards_${id}_damage-long`]);
					
					let extreme_hits = parseInt(v[`repeating_weapon-cards_${id}_hits-extreme`]);
					let extreme_damage = parseInt(v[`repeating_weapon-cards_${id}_damage-extreme`]);
					
					let jam_chance = v[`repeating_weapon-cards_${id}_jam`];
					
					let weapon_tags = v[`repeating_weapon-cards_${id}_weapon-tags`];
					weapon_tags = weapon_tags.toLocaleLowerCase();
					
					let rapid_fire = "";
					
					if (weapon_tags.indexOf("rapid fire") > -1) {
						rapid_fire = "?{Rapid Fire?|Yes,1|No,0}";
					}
					
					var jam = 1;
					var jam_rapid = 2;
					if (jam_chance.indexOf("/") > -1) {
						var chances = jam_chance.split("/");
						if (rapid_fire.length > 0 && chances.length > 1) {
							jam_rapid = parseInt(chances[1]);
						}
						if (chances.length > 0)
						{
							jam = parseInt(chances[0]);
						}
					}
					else {
						jam = parseInt(jam_chance);
						jam_rapid = jam + 1;
					}
					
					var jamming = "{{jam-chance-#distance#=[["+jam+"+(#hits#)]]}} {{jam-chance-rapid-#distance#=[["+jam_rapid+"+(#hits#)]]}}"
					
					let roll_temp = "[[2d10 + (@{character-hard})]]";
					if (roll_type === 1)
					{
						roll_temp = "[[3d10kh2 + (@{character-hard})]]";
					}
					else if(roll_type === -1) 
					{
						roll_temp = "[[3d10kl2 + (@{character-hard})]]";
					}
					
					var knife_crits   = "{{current-crits-roll=[[1d20 + ("+knife_hits+")   - (?{Target Armour Coverage?|0})]]}}";
					var close_crits   = "{{current-crits-roll=[[1d20 + ("+close_hits+")   - (?{Target Armour Coverage?|0})]]}}";
					var long_crits    = "{{current-crits-roll=[[1d20 + ("+long_hits+")   - (?{Target Armour Coverage?|0})]]}}";
					var extreme_crits = "{{current-crits-roll=[[1d20 + ("+extreme_hits+")   - (?{Target Armour Coverage?|0})]]}}";
					
					var mod_knife_hits = knife_hits;
					var iter = 2;
					while (mod_knife_hits > 1)
					{
						mod_knife_hits = mod_knife_hits/2;
						knife_crits += "{{current-crits-roll"+iter+"=[[1d20 + (" + mod_knife_hits +") - (?{Target Armour Coverage?|0})]]}}";
						iter+=1;
					}
					
					var mod_close_hits = close_hits;
					var iter = 2;
					while (mod_close_hits > 1)
					{
						mod_close_hits = mod_close_hits/2;
						close_crits += "{{current-crits-roll"+iter+"=[[1d20 + (" + mod_close_hits +") - (?{Target Armour Coverage?|0})]]}}";
						iter+=1;
					}
					
					var mod_long_hits = long_hits;
					var iter = 2;
					while (mod_long_hits > 1)
					{
						mod_long_hits = mod_long_hits/2;
						long_crits += "{{current-crits-roll"+iter+"=[[1d20 + (" + mod_long_hits +") - (?{Target Armour Coverage?|0})]]}}";
						iter+=1;
					}
					
					var mod_extreme_hits = extreme_hits;
					var iter = 2;
					while (mod_extreme_hits > 1)
					{
						mod_extreme_hits = mod_extreme_hits/2;
						extreme_crits += "{{current-crits-roll"+iter+"=[[1d20 + (" + mod_extreme_hits +") - (?{Target Armour Coverage?|0})]]}}";
						iter+=1;
					}
					
					let open_fire_move_knife = "&{template:open-fire} {{range=Knife}} {{roll=" + roll_temp + "}} {{current-damage=[[" + knife_damage + "]]}} {{current-hits=[["+ knife_hits+"]]}} {{closer-damage=[["+knife_damage+"]]}} {{closer-hits=[["+knife_hits+"]]}} {{farther-damage=[["+close_damage+"]]}} {{farther-hits=[["+close_hits+"]]}} {{furthest-damage=[["+long_damage+"]]}} {{furthest-hits=[["+long_hits+"]]}} "+knife_crits + modify_jamming(jamming, knife_hits, knife_hits, close_hits, long_hits);
					
					let open_fire_move_close = "&{template:open-fire} {{range=Close}} {{roll="+roll_temp+"}} {{current-damage=[["+close_damage+"]]}} {{current-hits=[["+close_hits+"]]}} {{closer-damage=[["+knife_damage+"]]}} {{closer-hits=[["+knife_hits+"]]}} {{farther-damage=[["+long_damage+"]]}} {{farther-hits=[["+long_hits+"]]}} {{furthest-damage=[["+extreme_damage+"]]}} {{furthest-hits=[["+extreme_hits+"]]}}"+close_crits + modify_jamming(jamming, knife_hits, close_hits, long_hits, extreme_hits);
					
					let open_fire_move_long = "&{template:open-fire} {{range=Long}} {{roll="+roll_temp+"}} {{current-damage=[["+long_damage+"]]}} {{current-hits=[["+long_hits+"]]}} {{closer-damage=[["+close_damage+"]]}} {{closer-hits=[["+close_hits+"]]}} {{farther-damage=[["+extreme_damage+"]]}} {{farther-hits=[["+extreme_hits+"]]}} {{furthest-damage=[[0]]}} {{furthest-hits=[[0]]}} "+long_crits + modify_jamming(jamming, close_hits, long_hits, extreme_hits, 0);
					
					let open_fire_move_extreme =  "&{template:open-fire} {{range=Extreme}} {{roll="+roll_temp+"}} {{current-damage=[["+extreme_damage+"]]}} {{current-hits=[["+extreme_hits+"]]}} {{closer-damage=[["+long_damage+"]]}} {{closer-hits=[["+long_hits+"]]}} {{farther-damage=[[0]]}} {{farther-hits=[[0]]}} {{furthest-damage=[[0]]}} {{furthest-hits=[[0]]}}"+extreme_crits + modify_jamming(jamming, long_hits, extreme_hits, 0, 0);
					
					
					open_fire_move_knife += knife_crits.replace(/current-crits-roll/g, "closer-crits-roll") + close_crits.replace(/current-crits-roll/g, "farther-crits-roll") + long_crits.replace(/current-crits-roll/g, "furthest-crits-roll");
					
					open_fire_move_close += knife_crits.replace(/current-crits-roll/g, "closer-crits-roll") + long_crits.replace(/current-crits-roll/g, "farther-crits-roll") + extreme_crits.replace(/current-crits-roll/g, "furthest-crits-roll");
					
					open_fire_move_long += close_crits.replace(/current-crits-roll/g, "closer-crits-roll") + extreme_crits.replace(/current-crits-roll/g, "farther-crits-roll");
				
					open_fire_move_extreme +=  long_crits.replace(/current-crits-roll/g, "closer-crits-roll");
					
					var obj = {};
					obj["repeating_weapon-cards_"+id+"_open-fire-move-knife"] = open_fire_move_knife;
					obj["repeating_weapon-cards_"+id+"_open-fire-move-close"] = open_fire_move_close;
					obj["repeating_weapon-cards_"+id+"_open-fire-move-long"] = open_fire_move_long;
					obj["repeating_weapon-cards_"+id+"_open-fire-move-extreme"] = open_fire_move_extreme;
					//console.log(obj);
					setAttrs(obj);
				});
			}
		});
	});
	
	on("change:primary-target-handling", function() {
		getAttrs(['primary-target-handling', 'full-load-handling'], function(v) {
			var opp_handling = parseInt(v['primary-target-handling']);
			var self_handling = parseInt(v['full-load-handling']);
			var agility = 0;
			
			if (opp_handling > self_handling)
			{
				agility = -1;
				if ((opp_handling-self_handling) > 9) {
					agility -= ((opp_handling-self_handling)/10);
				}
			}
			else if (self_handling > opp_handling) 
			{
				agility = 1;
				if ((self_handling-opp_handling) > 9) 
				{
					agility += ((self_handling-opp_handling)/10);
				}
			}
			agility = Math.floor(agility);
			setAttrs({'agility': agility});
		});
	});
	
	on("sheet:opened", function() {
		
	});
	
	//==== functions
	
	var updatePlaybook = function(e)
	{
		if (e.newValue === "Witch")
		{
			setAttrs({'wild-toggle': 'wild'});
		}
		else 
		{
			setAttrs({'wild-toggle':'none'});
		}
		//setAttrs({ "playbook":  
	}
</script>